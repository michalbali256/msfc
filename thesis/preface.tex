\chapter*{Introduction}
\addcontentsline{toc}{chapter}{Introduction}

A network traffic scheduler determines when, if and in what order the packets in packet-switching networks leave the network connection device. Although some kind of traffic scheduler is present in almost every device, its role is more complicated in routers, where it handles higher bitrates and affects the overall network performance.

Since the traffic scheduling has critical impact on the performance of packet-switched networks, it naturally becomes an object of interest of Internet Service Providers (ISPs): Correct scheduling of packets in traffic flows allows them to maximize the utilization of their available network resources, ensure the required fairness among their clients, prevent impact of misbehaving clients or malfunctioning hardware, and improve overall quality of service.

The term \emph{quality of service} (often shortened as QoS) is commonly used to denote an informal compound measure of various aspects of packet transfer service, including the available bandwidth, latency, packet loss, and others. Service differentiation, the ability of the QoS-providing mechanisms to satisfy different (possibly incompatible) requirements of different network traffic types, is an important part of the QoS.

ISPs often use classful hierarchical traffic schedulers like HTB or HFSC to achieve the differentiation of service quality. These allow precise bandwidth allocation to any recognizable type of service. However, their design predetermines them for centralized usage at the backbone of the network, which implies two main deficiencies:
\begin{enumerate}
\item The network administrator needs to know exact properties of the network to be able to tune it to optimal performance, which is impossible if the network properties change often, and brings administrative overhead if the number of the nodes and users in the network is large.
\item Even if the network staff would be able to both overcome this overhead and reconfigure the QoS mechanism on each of the network changes, it would still be impossible to properly handle (and prevent) some important kinds of network disturbances: Typically, wireless networks of some ISPs may change very frequently due to short (0.1s--1s) network disturbances caused by e.g. radio jams and atmospheric phenomena, which have impact on many latency-critical services. Centralized traffic scheduling is, by design, unable to properly react in such situations: The total time required to detect such disturbance reliably from a distance \emph{and} to reconfigure the centralized QoS mechanism to act accordingly is usually much higher than the actual duration of the disturbance, which renders any applied counter-measure ineffective.
\end{enumerate}

In this thesis we describe, implement and benchmark a traffic scheduler that aims to improve this situation: It is simple enough to be placed at the exact bottleneck of the network (e.g. a relatively small router with wireless interfaces) where it can quickly and precisely react to network problems and prevent impact on the quality of delivered service; at the same time it supports a multi-flow multi-priority stochastical traffic scheduling that guarantees a level of fairness and service differentiation that a typical ISP requires. At the same time, the required configuration input is kept minimal and mostly invariable even in changing networks. The design is built on previous research in the area --- it combines ideas of Controlled Delay (CoDel) \cite{CoDel} active queueing mechanism with Stochastic Fair Queueing (SFQ) \cite{SFQ} and uses Deficit Round-robin (DRR) \cite{EffDRR} algorithm to provide fairness and configurable prioritization of more `important' traffic classes.

The resulting traffic-scheduling algorithm is called Multilevel Stochastically Fair CoDel (MSFC). This thesis implements the algorithm in the environment of ns-3 network simulator \cite{ns3} for benchmarking. An experimental implementation of MSFC for Linux operating system kernel network traffic-control infrastructure has previously been implemented by the supervisor of this thesis, but has not been rigorously tested nor seriously benchmarked. Providing the benchmarks and thus showing that the scheduler is suitable for real-world deployment is the main result of this thesis.


\section*{Related Work}
The related research generally concerns various negative network phenomena and present solutions in the form of traffic schedulers. The bufferbloat was first addressed by Random Early Detection (RED) \cite{Floyd:1993:RED:169931.169935}, that used average queue occupancy as marker of full queue. Its later improvements include Advanced RED \cite{Floyd01adaptivered:}, Robust RED \cite{RRED}, and CHoKe \cite{pan2000choke}. In 2012, Nichols, Kathleen and Van Jacobson proposed Controlled Delay (CoDel) algorithm that uses the time that the packets spend in queue as a better and more precise indication of bufferbloat.

Another goal that the traffic schedulers try to achieve is to provide the same QoS to all users of the network. The concept of using a separate queue for each flow of packets called Fair Queueing (FQ) was first proposed by Nagle \cite{Nagle:FQ}. Stochastic FQ (SFQ) \cite{SFQ} uses a hash function to distinguish between flows. Bit-by-bit round-robin \cite{demers1989analysis} can be used to ensure absolute fairness for all flows, Deficit round-robin (DRR) \cite{EffDRR} approximates it to construct an algorithm with $\mathcal{O}(1)$ per-packet complexity. FQ CoDel \cite{fq_codel} combines CoDel with fair queueing and DRR.

The traffic schedulers mentioned above are commonly referred to as classless --- they do not assume that traffic may be differentiated into more categories. However, this is often not the case. Classful traffic schedulers allow the administrator to precisely define the shape of the traffic which corresponds with the real categories. These include Class Based Queueing (CBQ) \cite{CBQ}, Hierarchical Token Bucket (HTB) \cite{HTB} and Hierarchical Fair Service Curve (HFSC) \cite{HFSC}.

\section*{Layout of this Thesis}
This thesis is structered as follows: the first chapter provides a detailed overview of popular approaches to traffic scheduling. It presents issues of the area as well as principles and algorithms that address them. The second chapter describes the design of the MSFC scheduler and describes its Linux and ns-3 implementations. The third chapter concerns the simulations we performed in order to evaluate the scheduler performance and compare it to other traffic schedulers. Finally, it presents results of the benchmark.

